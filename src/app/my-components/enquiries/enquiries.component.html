<app-header></app-header>

<div class="container-fluid">
    <div class="page_heading">
        <div class="row align-items-center">
            <div class="col-md-9">
                <div class="page_name">
                    <img src="assets/images/enquiry.png" alt="" loading="lazy">
                    <h1 class="page_top_heading mb-0">enquiry info</h1>
                </div>
            </div>
            <div class="col-md-3 text-end">
                <div class="page_search">
                    <input type="text" class="search_form">
                    <button type="button" class="search_btn">
                        <span class="material-symbols-outlined">
                            search
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="main_body sec_gapping">
        <div class="info_div">
            <div class="page_info_heading">
                enquiries
            </div>
            <div class="my_form ">
                <div class="row">
                    <div class="col-sm-6 col-md-3">
                        <div class="form_select_div">
                            <label>sales incharge</label>
                            <div class="form_select_div">
                                <select class="form-control" [(ngModel)]="salesPersonId"
                                    (change)="getCustomerListBySalesperson();">
                                    <option *ngFor="let item of salesPersonList" [value]="item.sales_person_id">{{ item.sales_person_name }}</option>
                                </select>
                                <span class="material-symbols-outlined">
                                    stat_minus_1
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <div class="form_select_div">
                            <label>customer</label>
                            <div class="form_select_div">
                                <select class="form-control" [(ngModel)]="customerId">
                                    <option value="" disabled>--choose customer--</option>
                                    <option *ngFor="let item of customerBySalespersonList" [value]="item.customer_id">{{
                                        item.customer }}</option>
                                </select>
                                <span class="material-symbols-outlined">
                                    stat_minus_1
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3 col-md-3">
                        <div class="form_select_div ">
                            <label>enquiry date</label>
                            <input type="date" class="form-control" [(ngModel)]="enquiryDate">
                        </div>
                    </div>
                    <div class="col-sm-5 col-md-3">
                        <div class="">
                            <label>source of enquiry</label>
                            <div class="form_select_div">
                                <select class="form-control" [(ngModel)]="enquirySourceId">
                                    <option>--choose enquiry
                                        <source>--
                                    </option>
                                    <option *ngFor="let item of enquirySourceList" [value]="item.enquiry_source_id">{{
                                        item.enquiry_source_name }}</option>
                                </select>
                                <span class="material-symbols-outlined">
                                    stat_minus_1
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 col-md-3">
                        <div class="form_select_div">
                            <label>principal house</label>
                            <input type="text" class="form-control" [(ngModel)]="principalHouse">
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <div class="">
                            <label>date of offer</label>
                            <input type="date" class="form-control" [(ngModel)]="offerDate">
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <div class="form_select_div">
                            <label>basic value</label>
                            <input type="text" class="form-control" [(ngModel)]="basicValue">
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <div class="">
                            <label>Tentative Date of Finalisation</label>
                            <div class="d-flex">
                                <input type="text" class="form-control me-3" maxlength="2"
                                    (keypress)="restrictPhone($event)" [(ngModel)]="monthFinal" placeholder="MM">
                                <input type="text" class="form-control" maxlength="4" (keypress)="restrictPhone($event)"
                                    [(ngModel)]="yearFinal" placeholder="YYYY">
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-4">
                        <div class="">
                            <label>status</label>
                            <input type="text" class="form-control" [(ngModel)]="enquiryStatus">
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-4">
                        <div class="">
                            <label>remarks</label>
                            <input type="text" class="form-control" [(ngModel)]="enquiryRemarks">
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-4">
                        <div class="">
                            <label>support required</label>
                            <input type="text" class="form-control" [(ngModel)]="enquirySupport">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-center mt-3">
            <button mat-flat-button class="btn1" (click)="createEnquiry()">submit</button>
        </div>
    </div>


    <div class="listing_div">
        <h3 class="text-end" style="font-size: 20px;">total : {{ totalCount }}</h3>
        <div class="table-responsive">
            <table class="listing_table">
                <tr class="table_head">
                    <th>sl no.</th>
                    <th>sales incharge</th>
                    <th>customer</th>
                    <th>enquiry date</th>
                    <th>enquiry source</th>
                    <th>principal house</th>
                    <th>offer date</th>
                    <th>basic value</th>
                    <th>tentative date of finalisation</th>
                    <th>follow up</th>
                    <th>view</th>
                    <th>edit</th>
                    <th>delete</th>
                </tr>

                <tr *ngFor="let item of enquiryList; let i = index">
                    <td>{{ i+1 }}</td>
                    <td>{{ item.sales_person_name }}</td>
                    <td>{{ item.customer}}</td>
                    <td>{{ item.enquiry_date }}</td>
                    <td>{{ item.enquiry_source_name }}</td>
                    <td>{{ item.principal_house }}</td>
                    <td>{{ item.offer_date }}</td>
                    <td>{{ item.basic_value}}</td>
                    <ng-container
                        *ngIf="(item.tentative_finalization_month && item.tentative_finalization_year); else notAvailable">
                        <td>{{item.tentative_finalization_month}} / {{item.tentative_finalization_year}}</td>
                    </ng-container>
                    <ng-template #notAvailable>
                        <td>NA</td>
                    </ng-template>
                    <td>
                        <span class="follow_up" (click)="goToFollowUpPage()">
                            <span class="material-symbols-outlined" style="color:#1b1b1b;font-size: 18px;">
                                visibility
                            </span>
                            follow up
                        </span>
                    </td>
                    <td>
                        <span class="material-symbols-outlined" style="color:#006FFD;"
                            (click)="goToDetailsPage(item.enquiry_id)">
                            visibility
                        </span>
                    </td>
                    <td>
                        <span class="material-symbols-outlined" style="color: #00BF58;"
                            (click)="getEnquiryById(item.enquiry_id)">
                            edit_square
                        </span>
                    </td>
                    <!-- <td *ngIf="sbuId != 0"> -->
                    <td>
                        <span class="material-symbols-outlined" style="color: #A8226A;">
                            delete
                        </span>
                    </td>
                </tr>

            </table>
        </div>
    </div>

</div>